"use strict";var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var hasBlobConstructor="undefined"!=typeof Blob&&function(){try{return Boolean(new Blob)}catch(e){return!1}}(),hasArrayBufferViewSupport=hasBlobConstructor&&"undefined"!=typeof Uint8Array&&function(){try{return 100===new Blob([new Uint8Array(100)]).size}catch(e){return!1}}(),hasToBlobSupport="undefined"!=typeof HTMLCanvasElement&&HTMLCanvasElement.prototype.toBlob,hasBlobSupport=hasToBlobSupport||"undefined"!=typeof Uint8Array&&"undefined"!=typeof ArrayBuffer&&"undefined"!=typeof atob,hasReaderSupport="undefined"!=typeof FileReader||"undefined"!=typeof URL,ImageTools=function(){function ImageTools(){_classCallCheck(this,ImageTools)}return _createClass(ImageTools,null,[{key:"resize",value:function resize(file,maxDimensions,callback){"function"==typeof maxDimensions&&(callback=maxDimensions,maxDimensions={width:640,height:480});var maxWidth=maxDimensions.width,maxHeight=maxDimensions.height;if(!ImageTools.isSupported()||!file.type.match(/image.*/))return callback(file,!1),!1;if(file.type.match(/image\/gif/))return callback(file,!1),!1;var image=document.createElement("img");return image.onload=function(imgEvt){var width=image.width,height=image.height,isTooLarge=!1;if(width>height&&width>maxDimensions.width?(height*=maxDimensions.width/width,width=maxDimensions.width,isTooLarge=!0):height>maxDimensions.height&&(width*=maxDimensions.height/height,height=maxDimensions.height,isTooLarge=!0),isTooLarge){var canvas=document.createElement("canvas"),ctx;if(canvas.width=width,canvas.height=height,canvas.getContext("2d").drawImage(image,0,0,width,height),hasToBlobSupport)canvas.toBlob(function(blob){callback(blob,!0)},file.type);else{var blob=ImageTools._toBlob(canvas,file.type);callback(blob,!0)}}else callback(file,!1)},ImageTools._loadImage(image,file),!0}},{key:"_toBlob",value:function _toBlob(canvas,type){var dataURI,dataURIParts=canvas.toDataURL(type).split(","),byteString=void 0;byteString=dataURIParts[0].indexOf("base64")>=0?atob(dataURIParts[1]):decodeURIComponent(dataURIParts[1]);for(var arrayBuffer=new ArrayBuffer(byteString.length),intArray=new Uint8Array(arrayBuffer),i=0;i<byteString.length;i+=1)intArray[i]=byteString.charCodeAt(i);var mimeString=dataURIParts[0].split(":")[1].split(";")[0],blob=null;if(hasBlobConstructor)blob=new Blob([hasArrayBufferViewSupport?intArray:arrayBuffer],{type:mimeString});else{var bb=new BlobBuilder;bb.append(arrayBuffer),blob=bb.getBlob(mimeString)}return blob}},{key:"_loadImage",value:function _loadImage(image,file,callback){if("undefined"==typeof URL){var reader=new FileReader;reader.onload=function(evt){image.src=evt.target.result,callback&&callback()},reader.readAsDataURL(file)}else image.src=URL.createObjectURL(file),callback&&callback()}},{key:"isSupported",value:function isSupported(){return"undefined"!=typeof HTMLCanvasElement&&hasBlobSupport&&hasReaderSupport}}]),ImageTools}();